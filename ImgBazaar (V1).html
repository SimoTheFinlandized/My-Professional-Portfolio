<!DOCTYPE html><html lang="en"><head><meta name="x-poe-datastore-behavior" content="local_only"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImgBazaar Pro - Ultimate Meme &amp; GIF Creator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&amp;family=Righteous&amp;family=Archivo+Black&amp;family=Work+Sans:wght@400;600;700&amp;display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #16213e;
            --accent-primary: #ff6b35;
            --accent-secondary: #f7931e;
            --accent-tertiary: #ffd700;
            --text-primary: #ffffff;
            --text-secondary: #b8b8d1;
            --border-color: #2d3561;
            --shadow: rgba(255, 107, 53, 0.3);
        }

        .dark {
            --bg-primary: #0f0f23;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #16213e;
            --accent-primary: #ff6b35;
            --accent-secondary: #f7931e;
            --accent-tertiary: #ffd700;
            --text-primary: #ffffff;
            --text-secondary: #b8b8d1;
            --border-color: #2d3561;
            --shadow: rgba(255, 107, 53, 0.3);
        }

        :root:not(.dark) {
            --bg-primary: #fef9f3;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f5f5f5;
            --accent-primary: #ff6b35;
            --accent-secondary: #f7931e;
            --accent-tertiary: #ff8c42;
            --text-primary: #1a1a2e;
            --text-secondary: #5a5a6e;
            --border-color: #e0e0e0;
            --shadow: rgba(255, 107, 53, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Work Sans', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-tertiary) 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            position: relative;
        }

        h1 {
            font-family: 'Bebas Neue', sans-serif;
            font-size: clamp(2.5rem, 8vw, 5rem);
            letter-spacing: 4px;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary), var(--accent-tertiary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            animation: glow 3s ease-in-out infinite;
        }

        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 20px var(--shadow)); }
            50% { filter: drop-shadow(0 0 40px var(--shadow)); }
        }

        .tagline {
            font-family: 'Righteous', sans-serif;
            font-size: 1.2rem;
            color: var(--text-secondary);
            letter-spacing: 2px;
        }

        .pro-badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--accent-tertiary), var(--accent-secondary));
            color: var(--bg-primary);
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            margin-left: 10px;
            letter-spacing: 1px;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 12px 24px;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            border-radius: 50px;
            color: var(--text-primary);
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-color: transparent;
            color: white;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 30px;
            margin-top: 40px;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr 2fr;
            }
            .right-sidebar {
                grid-column: 1 / -1;
            }
        }

        @media (max-width: 968px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .sidebar, .right-sidebar {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid var(--border-color);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .editor-area {
            background: var(--bg-secondary);
            border-radius: 20px;
            padding: 30px;
            border: 2px solid var(--border-color);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        h2 {
            font-family: 'Archivo Black', sans-serif;
            color: var(--accent-primary);
            margin-bottom: 20px;
            font-size: 1.8rem;
            letter-spacing: 1px;
        }

        h3 {
            font-family: 'Righteous', sans-serif;
            color: var(--accent-secondary);
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .templates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .template-item {
            cursor: pointer;
            border-radius: 12px;
            overflow: hidden;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }

        .template-item:hover {
            border-color: var(--accent-secondary);
            transform: translateY(-5px);
            box-shadow: 0 10px 20px var(--shadow);
        }

        .template-item.selected {
            border-color: var(--accent-primary);
            box-shadow: 0 0 20px var(--shadow);
        }

        .template-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            display: block;
        }

        .template-name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px;
            font-size: 0.7rem;
            text-align: center;
            font-weight: 600;
        }

        .section {
            margin-bottom: 25px;
        }

        .section-title {
            font-family: 'Righteous', sans-serif;
            color: var(--accent-secondary);
            margin-bottom: 12px;
            font-size: 1rem;
            letter-spacing: 1px;
        }

        .btn {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 50px;
            cursor: pointer;
            font-family: 'Work Sans', sans-serif;
            font-weight: 700;
            font-size: 1rem;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px var(--shadow);
            width: 100%;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--shadow);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        input[type="text"],
        input[type="number"],
        input[type="color"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 2px solid var(--border-color);
            background: var(--bg-tertiary);
            color: var(--text-primary);
            font-family: 'Work Sans', sans-serif;
            font-size: 16px;
            margin-bottom: 12px;
            transition: border-color 0.3s ease;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        input[type="file"] {
            display: none;
        }

        .canvas-container {
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        #memeCanvas {
            max-width: 100%;
            height: auto;
            border: 3px solid var(--accent-primary);
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            background: white;
            cursor: crosshair;
        }

        .controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        @media (max-width: 600px) {
            .controls-grid {
                grid-template-columns: 1fr;
            }
        }

        .control-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .gallery {
            margin-top: 60px;
            padding-top: 40px;
            border-top: 2px solid var(--border-color);
        }

        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .gallery-item {
            position: relative;
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
            background: var(--bg-tertiary);
            animation: slideInUp 0.5s ease forwards;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px var(--shadow);
            border-color: var(--accent-primary);
        }

        .gallery-item img, .gallery-item video {
            width: 100%;
            height: auto;
            display: block;
        }

        .gallery-item-info {
            padding: 15px;
            background: var(--bg-tertiary);
        }

        .gallery-item-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 10px;
        }

        .gallery-item-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .gallery-item:hover .gallery-item-actions {
            opacity: 1;
        }

        .icon-btn {
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .icon-btn:hover {
            background: var(--accent-primary);
            transform: scale(1.1);
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .color-picker-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-picker-wrapper input[type="color"] {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            border: 2px solid var(--border-color);
            cursor: pointer;
            padding: 0;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Work Sans', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            border-color: transparent;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: var(--bg-tertiary);
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-primary);
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-primary);
            cursor: pointer;
            border: none;
        }

        .monetization-section {
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.1), rgba(247, 147, 30, 0.1));
            border: 2px solid var(--accent-primary);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .earnings-display {
            text-align: center;
            padding: 20px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .earnings-amount {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            color: var(--accent-tertiary);
            margin: 10px 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .stat-card {
            background: var(--bg-tertiary);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--accent-primary);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 20px;
            max-width: 90%;
            max-height: 90%;
            overflow: auto;
            border: 2px solid var(--accent-primary);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-content img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
        }

        .close-modal {
            float: right;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: color 0.3s ease;
        }

        .close-modal:hover {
            color: var(--accent-primary);
        }

        .sticker-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .sticker-item {
            font-size: 2.5rem;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s ease;
            background: var(--bg-tertiary);
        }

        .sticker-item:hover {
            transform: scale(1.2);
            background: var(--accent-primary);
        }

        .drawing-tools {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .tool-btn {
            padding: 10px 20px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tool-btn.active {
            background: var(--accent-primary);
            border-color: var(--accent-primary);
            color: white;
        }

        .challenge-card {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border: 2px solid var(--border-color);
        }

        .challenge-card.featured {
            border-color: var(--accent-tertiary);
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(247, 147, 30, 0.1));
        }

        .sponsor-card {
            background: linear-gradient(135deg, rgba(107, 255, 53, 0.1), rgba(30, 247, 147, 0.1));
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            border: 2px solid #2ecc71;
        }

        .marketplace-item {
            background: var(--bg-tertiary);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .marketplace-item:hover {
            border-color: var(--accent-primary);
            transform: translateY(-5px);
        }

        .price-tag {
            background: var(--accent-tertiary);
            color: var(--bg-primary);
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: 700;
            display: inline-block;
        }

        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-right: 5px;
        }

        .badge-trending {
            background: var(--accent-primary);
            color: white;
        }

        .badge-new {
            background: #2ecc71;
            color: white;
        }

        .badge-hot {
            background: var(--accent-tertiary);
            color: var(--bg-primary);
        }

        .loading-spinner {
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--accent-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            background-color: rgba(0, 0, 0, 0.9);
            color: white;
            text-align: center;
            padding: 5px 10px;
            border-radius: 6px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-size: 0.75rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
        }

        .keyboard-hint {
            font-size: 0.7rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .ai-suggestion {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.2), rgba(75, 0, 130, 0.2));
            border: 2px solid #8b2be2;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
        }

        .video-preview {
            max-width: 100%;
            border-radius: 10px;
            margin: 10px 0;
        }

        .collab-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--accent-primary);
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: 600;
            z-index: 100;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .nft-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.7rem;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>IMGBAZAAR<span class="pro-badge">ULTIMATE PRO</span></h1>
            <p class="tagline">AI-POWERED ‚Ä¢ COLLABORATIVE ‚Ä¢ MONETIZED</p>
        </header>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchPage('creator')">üé® Creator Studio</button>
            <button class="nav-tab" onclick="switchPage('social')">üåç Social Feed</button>
            <button class="nav-tab" onclick="switchPage('challenges')">üèÜ Challenges</button>
            <button class="nav-tab" onclick="switchPage('marketplace')">üõí Marketplace</button>
            <button class="nav-tab" onclick="switchPage('sponsors')">üíº Sponsorships</button>
            <button class="nav-tab" onclick="switchPage('analytics')">üìä Analytics</button>
        </div>

        <!-- CREATOR STUDIO PAGE -->
        <div id="creatorPage" class="page active">
            <div class="main-content">
                <aside class="sidebar">
                    <h2>Assets</h2>

                    <div class="section">
                        <div class="section-title">Templates</div>
                        <div class="templates-grid" id="templatesGrid"></div>
                    </div>

                    <div class="section">
                        <div class="section-title">Upload Media</div>
                        <label for="imageUpload" class="btn btn-secondary">üìÅ Upload Image</label>
                        <input type="file" id="imageUpload" accept="image/*">
                        <label for="videoUpload" class="btn btn-secondary">üé• Upload Video</label>
                        <input type="file" id="videoUpload" accept="video/*">
                    </div>

                    <div class="section">
                        <div class="section-title">ü§ñ AI Tools</div>
                        <button class="btn" onclick="generateAITemplate()">‚ú® AI Generate Template</button>
                        <button class="btn" onclick="generateAICaptions()">üí¨ AI Caption Suggestions</button>
                        <button class="btn" onclick="analyzeImage()">üëÅÔ∏è Auto-Caption from Image</button>
                        <button class="btn" onclick="removeBackground()">üé≠ Remove Background</button>
                        <button class="btn" onclick="startVoiceInput()">üé§ Voice to Text</button>
                    </div>

                    <div class="section">
                        <div class="section-title">Stickers &amp; Emojis</div>
                        <div class="sticker-grid" id="stickerGrid"></div>
                    </div>

                    <div class="monetization-section">
                        <h3>üí∞ Your Earnings</h3>
                        <div class="earnings-display">
                            <div style="font-size: 0.9rem; color: var(--text-secondary);">Total Balance</div>
                            <div class="earnings-amount">$<span id="totalEarnings">0.00</span></div>
                            <div style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 5px;">
                                +$<span id="earningsToday">0.00</span> today
                            </div>
                        </div>
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="viewCount">0</div>
                                <div class="stat-label">VIEWS</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="shareCount">0</div>
                                <div class="stat-label">SHARES</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="memeCount">0</div>
                                <div class="stat-label">MEMES</div>
                            </div>
                        </div>
                        <button class="btn" style="margin-top: 15px;" onclick="withdrawEarnings()">üí≥ Withdraw ($10 min)</button>
                    </div>
                </aside>

                <main class="editor-area">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>Editor <span class="keyboard-hint">(Press ? for shortcuts)</span></h2>
                        <div>
                            <button class="btn btn-small btn-secondary" onclick="undo()" title="Ctrl+Z">‚Ü∂ Undo</button>
                            <button class="btn btn-small btn-secondary" onclick="redo()" title="Ctrl+Y">‚Ü∑ Redo</button>
                        </div>
                    </div>

                    <div class="canvas-container">
                        <canvas id="memeCanvas" width="800" height="600"></canvas>
                    </div>

                    <div class="tab-buttons">
                        <button class="tab-btn active" onclick="switchTab('text')">‚úèÔ∏è Text</button>
                        <button class="tab-btn" onclick="switchTab('style')">üé® Style</button>
                        <button class="tab-btn" onclick="switchTab('effects')">‚ú® Effects</button>
                        <button class="tab-btn" onclick="switchTab('draw')">üñåÔ∏è Draw</button>
                        <button class="tab-btn" onclick="switchTab('gif')">üé¨ GIF</button>
                        <button class="tab-btn" onclick="switchTab('video')">üìπ Video</button>
                    </div>

                    <div id="textTab" class="tab-content active">
                        <button class="btn" onclick="addTextBox()">‚ûï Add Text Box (Ctrl+T)</button>
                        <div id="textBoxControls"></div>
                    </div>

                    <div id="styleTab" class="tab-content">
                        <div class="controls-grid">
                            <div class="control-group">
                                <label>Font Size</label>
                                <input type="number" id="fontSize" value="48" min="20" max="120">
                            </div>
                            <div class="control-group">
                                <label>Font Family</label>
                                <select id="fontFamily">
                                    <option value="Impact">Impact</option>
                                    <option value="Arial Black">Arial Black</option>
                                    <option value="Bebas Neue">Bebas Neue</option>
                                    <option value="Righteous">Righteous</option>
                                    <option value="Archivo Black">Archivo Black</option>
                                    <option value="Comic Sans MS">Comic Sans MS</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>Text Color</label>
                                <input type="color" id="textColor" value="#ffffff">
                            </div>
                            <div class="control-group">
                                <label>Stroke Color</label>
                                <input type="color" id="strokeColor" value="#000000">
                            </div>
                            <div class="control-group">
                                <label>Stroke Width: <span id="strokeWidthValue">3</span></label>
                                <input type="range" id="strokeWidth" value="3" min="0" max="10">
                            </div>
                            <div class="control-group">
                                <label>Opacity: <span id="textOpacityValue">100%</span></label>
                                <input type="range" id="textOpacity" value="100" min="0" max="100">
                            </div>
                        </div>
                    </div>

                    <div id="effectsTab" class="tab-content">
                        <div class="controls-grid">
                            <div class="control-group">
                                <label>Brightness: <span id="brightnessValue">100%</span></label>
                                <input type="range" id="brightness" value="100" min="0" max="200">
                            </div>
                            <div class="control-group">
                                <label>Contrast: <span id="contrastValue">100%</span></label>
                                <input type="range" id="contrast" value="100" min="0" max="200">
                            </div>
                            <div class="control-group">
                                <label>Saturation: <span id="saturationValue">100%</span></label>
                                <input type="range" id="saturation" value="100" min="0" max="200">
                            </div>
                            <div class="control-group">
                                <label>Blur: <span id="blurValue">0px</span></label>
                                <input type="range" id="blur" value="0" min="0" max="10">
                            </div>
                        </div>
                        <button class="btn btn-secondary" onclick="resetFilters()">Reset Filters</button>
                    </div>

                    <div id="drawTab" class="tab-content">
                        <div class="drawing-tools">
                            <button class="tool-btn active" onclick="setDrawTool('pen')">üñäÔ∏è Pen</button>
                            <button class="tool-btn" onclick="setDrawTool('line')">üìè Line</button>
                            <button class="tool-btn" onclick="setDrawTool('arrow')">‚û°Ô∏è Arrow</button>
                            <button class="tool-btn" onclick="setDrawTool('rectangle')">‚¨ú Rectangle</button>
                            <button class="tool-btn" onclick="setDrawTool('circle')">‚≠ï Circle</button>
                            <button class="tool-btn" onclick="setDrawTool('highlight')">üñçÔ∏è Highlight</button>
                        </div>
                        <div class="controls-grid">
                            <div class="control-group">
                                <label>Brush Color</label>
                                <input type="color" id="brushColor" value="#ff0000">
                            </div>
                            <div class="control-group">
                                <label>Brush Size: <span id="brushSizeValue">5</span></label>
                                <input type="range" id="brushSize" value="5" min="1" max="50">
                            </div>
                        </div>
                        <button class="btn btn-secondary" onclick="clearDrawing()">Clear Drawing</button>
                    </div>

                    <div id="gifTab" class="tab-content">
                        <button class="btn" onclick="captureFrame()">üì∏ Capture Frame</button>
                        <div class="controls-grid">
                            <div class="control-group">
                                <label>Frame Delay (ms)</label>
                                <input type="number" id="frameDelay" value="500" min="100">
                            </div>
                            <div class="control-group">
                                <label>Loop Count</label>
                                <select id="gifLoop">
                                    <option value="0">Infinite</option>
                                    <option value="1">Once</option>
                                    <option value="3">3 times</option>
                                </select>
                            </div>
                        </div>
                        <div id="framePreview" style="margin: 15px 0;"></div>
                        <button class="btn" onclick="createGIF()" id="createGIFBtn" disabled="">üé¨ Create GIF</button>
                    </div>

                    <div id="videoTab" class="tab-content">
                        <div id="videoControls">
                            <p style="color: var(--text-secondary); margin-bottom: 15px;">Upload a video to add text overlays at specific timestamps</p>
                            <div id="videoTimeline"></div>
                        </div>
                    </div>

                    <div class="section" style="margin-top: 30px;">
                        <div class="controls-grid">
                            <button class="btn" onclick="downloadMeme()">üíæ Download HD (4K)</button>
                            <button class="btn" onclick="shareMeme()">üì§ Share &amp; Earn</button>
                            <button class="btn" onclick="mintNFT()">üé® Mint as NFT</button>
                            <button class="btn" onclick="openCollabRoom()">üë• Collaborate</button>
                        </div>
                    </div>
                </main>

                <aside class="right-sidebar">
                    <h3>Quick Actions</h3>
                    <button class="btn btn-secondary" onclick="duplicateCanvas()">üìã Duplicate (Ctrl+D)</button>
                    <button class="btn btn-secondary" onclick="exportBatch()">üì¶ Batch Export</button>
                    <button class="btn btn-secondary" onclick="clearCanvas()">üîÑ Start Over</button>

                    <h3 style="margin-top: 30px;">AI Suggestions</h3>
                    <div id="aiSuggestions">
                        <div class="ai-suggestion" style="display: none;">
                            <p style="margin-bottom: 10px; font-weight: 600;">üí° Suggested Caption:</p>
                            <p id="aiCaptionText" style="font-style: italic;"></p>
                            <button class="btn btn-small" onclick="applyAISuggestion()">Apply</button>
                        </div>
                    </div>

                    <h3 style="margin-top: 30px;">Layer Manager</h3>
                    <div id="layerList"></div>
                </aside>
            </div>

            <div class="gallery">
                <h2>Your Creations</h2>
                <div class="gallery-grid" id="galleryGrid">
                    <div class="empty-state">
                        <div class="empty-state-icon">üé®</div>
                        <p>No memes created yet. Start creating!</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- SOCIAL FEED PAGE -->
        <div id="socialPage" class="page">
            <h2>üåç Trending Memes</h2>
            <div class="gallery-grid" id="socialFeed"></div>
        </div>

        <!-- CHALLENGES PAGE -->
        <div id="challengesPage" class="page">
            <h2>üèÜ Active Challenges</h2>
            <div id="challengesList"></div>
        </div>

        <!-- MARKETPLACE PAGE -->
        <div id="marketplacePage" class="page">
            <h2>üõí Template Marketplace</h2>
            <div class="gallery-grid" id="marketplaceGrid"></div>
        </div>

        <!-- SPONSORS PAGE -->
        <div id="sponsorsPage" class="page">
            <h2>üíº Sponsorship Opportunities</h2>
            <div id="sponsorsList"></div>
        </div>

        <!-- ANALYTICS PAGE -->
        <div id="analyticsPage" class="page">
            <h2>üìä Your Analytics</h2>
            <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0;">
                <div class="stat-card" style="padding: 30px;">
                    <div class="stat-label">TOTAL EARNINGS</div>
                    <div class="stat-value" style="font-size: 2rem;">$<span id="analyticsEarnings">0.00</span></div>
                </div>
                <div class="stat-card" style="padding: 30px;">
                    <div class="stat-label">AVG. VIEWS/MEME</div>
                    <div class="stat-value" style="font-size: 2rem;" id="avgViews">0</div>
                </div>
                <div class="stat-card" style="padding: 30px;">
                    <div class="stat-label">ENGAGEMENT RATE</div>
                    <div class="stat-value" style="font-size: 2rem;" id="engagementRate">0%</div>
                </div>
                <div class="stat-card" style="padding: 30px;">
                    <div class="stat-label">BEST TIME TO POST</div>
                    <div class="stat-value" style="font-size: 2rem;" id="bestTime">--:--</div>
                </div>
            </div>
            <div id="topMemes"></div>
        </div>
    </div>

    <div class="modal" id="imageModal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">√ó</span>
            <div id="modalContentArea"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.js"></script>
    <script>
        // Dark mode
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }

        // Global state
        const canvas = document.getElementById('memeCanvas');
        const ctx = canvas.getContext('2d');
        let currentImage = null;
        let currentVideo = null;
        let textBoxes = [];
        let stickers = [];
        let drawings = [];
        let history = [];
        let historyIndex = -1;
        let gifFrames = [];
        let filters = { brightness: 100, contrast: 100, saturation: 100, blur: 0 };
        let drawTool = 'pen';
        let isDrawing = false;
        let drawStart = null;
        let monetizationData = { totalEarnings: 0, earningsToday: 0, views: 0, shares: 0, memes: 0 };

        // Templates with placeholders
        const templates = [
            { name: 'Drake', url: 'https://picsum.photos/seed/drake/400/400' },
            { name: 'Distracted BF', url: 'https://picsum.photos/seed/distracted/400/300' },
            { name: 'Two Buttons', url: 'https://picsum.photos/seed/buttons/400/300' },
            { name: 'Change Mind', url: 'https://picsum.photos/seed/mind/400/400' },
            { name: 'This Is Fine', url: 'https://picsum.photos/seed/fine/400/300' },
            { name: 'Woman Yelling', url: 'https://picsum.photos/seed/yelling/400/300' },
            { name: 'Success Kid', url: 'https://picsum.photos/seed/success/400/400' },
            { name: 'Roll Safe', url: 'https://picsum.photos/seed/roll/400/400' },
            { name: 'Expanding Brain', url: 'https://picsum.photos/seed/brain/400/500' },
            { name: 'Bernie Sanders', url: 'https://picsum.photos/seed/bernie/400/400' }
        ];

        // Available sticker emojis
        const availableStickers = ['üòÇ', 'üò≠', 'üíÄ', 'üî•', 'üíØ', 'üëÄ', 'ü§î', 'üòé', 'ü§£', 'üòç', 'ü•∫', 'üò§', 'üôÑ', 'üí©', 'üëª', 'ü§°', 'ü¶Ñ', 'üåà', '‚≠ê', '‚ú®', 'üíé', 'üöÄ', 'üí∞', 'üèÜ'];

        // Initialize
        function init() {
            loadTemplates();
            loadStickers();
            initializeCanvas();
            initializeSocialFeed();
            initializeChallenges();
            initializeMarketplace();
            initializeSponsors();
            setupKeyboardShortcuts();
            startViewSimulation();
        }

        function loadTemplates() {
            const grid = document.getElementById('templatesGrid');
            grid.innerHTML = '';
            templates.forEach((template, index) => {
                const div = document.createElement('div');
                div.className = 'template-item';
                div.innerHTML = `
                    <img src="${template.url}" alt="${template.name}">
                    <div class="template-name">${template.name}</div>
                `;
                div.onclick = () => selectTemplate(template.url);
                grid.appendChild(div);
            });
        }

        function loadStickers() {
            const grid = document.getElementById('stickerGrid');
            grid.innerHTML = '';
            availableStickers.forEach(sticker => {
                const div = document.createElement('div');
                div.className = 'sticker-item';
                div.textContent = sticker;
                div.onclick = () => addSticker(sticker);
                grid.appendChild(div);
            });
        }

        function selectTemplate(url) {
            const img = new Image();
            img.crossOrigin = 'anonymous';
            img.onload = () => {
                currentImage = img;
                canvas.width = img.width;
                canvas.height = img.height;
                saveState();
                drawCanvas();
            };
            img.src = url;
        }

        document.getElementById('imageUpload').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    const img = new Image();
                    img.onload = () => {
                        currentImage = img;
                        canvas.width = img.width;
                        canvas.height = img.height;
                        saveState();
                        drawCanvas();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('videoUpload').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    currentVideo = event.target.result;
                    showCustomAlert('Video uploaded! Switch to Video tab to add text overlays.');
                };
                reader.readAsDataURL(file);
            }
        });

        function initializeCanvas() {
            // Canvas event listeners for drawing
            canvas.addEventListener('mousedown', startDraw);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', endDraw);
            canvas.addEventListener('mouseout', endDraw);

            // Touch support
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousedown', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            });

            canvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousemove', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            });

            canvas.addEventListener('touchend', (e) => {
                e.preventDefault();
                const mouseEvent = new MouseEvent('mouseup', {});
                canvas.dispatchEvent(mouseEvent);
            });
        }

        function addTextBox() {
            const newBox = {
                type: 'text',
                text: 'NEW TEXT',
                x: canvas.width / 2,
                y: 50 + (textBoxes.length * 60),
                fontSize: 48,
                fontFamily: 'Impact',
                color: '#ffffff',
                strokeColor: '#000000',
                strokeWidth: 3,
                opacity: 100,
                rotation: 0,
                align: 'center'
            };
            textBoxes.push(newBox);
            saveState();
            drawCanvas();
            updateTextBoxControls();
        }

        function addSticker(emoji) {
            const sticker = {
                type: 'sticker',
                emoji: emoji,
                x: canvas.width / 2,
                y: canvas.height / 2,
                size: 80
            };
            textBoxes.push(sticker);
            saveState();
            drawCanvas();
        }

        function updateTextBoxControls() {
            const container = document.getElementById('textBoxControls');
            container.innerHTML = '';
            textBoxes.forEach((box, index) => {
                if (box.type === 'text') {
                    const div = document.createElement('div');
                    div.className = 'section';
                    div.innerHTML = `
                        <label>Text Box ${index + 1}</label>
                        <textarea onchange="updateTextBox(${index}, this.value)">${box.text}</textarea>
                        <div class="controls-grid">
                            <input type="number" placeholder="X" value="${box.x}" onchange="textBoxes[${index}].x = parseInt(this.value); drawCanvas();">
                            <input type="number" placeholder="Y" value="${box.y}" onchange="textBoxes[${index}].y = parseInt(this.value); drawCanvas();">
                        </div>
                        <button class="btn btn-secondary btn-small" onclick="removeTextBox(${index})">üóëÔ∏è Remove</button>
                    `;
                    container.appendChild(div);
                }
            });
        }

        function updateTextBox(index, text) {
            textBoxes[index].text = text;
            saveState();
            drawCanvas();
        }

        function removeTextBox(index) {
            textBoxes.splice(index, 1);
            saveState();
            drawCanvas();
            updateTextBoxControls();
        }

        // Drawing functions
        function startDraw(e) {
            if (switchTab.name !== 'draw') return;
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            drawStart = {
                x: (e.clientX - rect.left) * (canvas.width / rect.width),
                y: (e.clientY - rect.top) * (canvas.height / rect.height)
            };
        }

        function draw(e) {
            if (!isDrawing || switchTab.name !== 'draw') return;
            const rect = canvas.getBoundingClientRect();
            const pos = {
                x: (e.clientX - rect.left) * (canvas.width / rect.width),
                y: (e.clientY - rect.top) * (canvas.height / rect.height)
            };

            if (drawTool === 'pen') {
                drawings.push({
                    type: 'pen',
                    from: drawStart,
                    to: pos,
                    color: document.getElementById('brushColor').value,
                    size: parseInt(document.getElementById('brushSize').value)
                });
                drawStart = pos;
                drawCanvas();
            }
        }

        function endDraw(e) {
            if (!isDrawing) return;
            isDrawing = false;
            const rect = canvas.getBoundingClientRect();
            const pos = {
                x: (e.clientX - rect.left) * (canvas.width / rect.width),
                y: (e.clientY - rect.top) * (canvas.height / rect.height)
            };

            const color = document.getElementById('brushColor').value;
            const size = parseInt(document.getElementById('brushSize').value);

            if (drawTool === 'line') {
                drawings.push({ type: 'line', from: drawStart, to: pos, color, size });
            } else if (drawTool === 'arrow') {
                drawings.push({ type: 'arrow', from: drawStart, to: pos, color, size });
            } else if (drawTool === 'rectangle') {
                drawings.push({ type: 'rectangle', from: drawStart, to: pos, color, size });
            } else if (drawTool === 'circle') {
                drawings.push({ type: 'circle', from: drawStart, to: pos, color, size });
            } else if (drawTool === 'highlight') {
                drawings.push({ type: 'highlight', from: drawStart, to: pos, color, size });
            }

            saveState();
            drawCanvas();
        }

        function setDrawTool(tool) {
            drawTool = tool;
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        function clearDrawing() {
            drawings = [];
            saveState();
            drawCanvas();
        }

        function drawCanvas() {
            if (!currentImage) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Apply filters
            ctx.filter = `brightness(${filters.brightness}%) contrast(${filters.contrast}%) saturate(${filters.saturation}%) blur(${filters.blur}px)`;
            ctx.drawImage(currentImage, 0, 0, canvas.width, canvas.height);
            ctx.filter = 'none';

            // Draw drawings
            drawings.forEach(drawing => {
                ctx.strokeStyle = drawing.color;
                ctx.fillStyle = drawing.color;
                ctx.lineWidth = drawing.size;

                if (drawing.type === 'pen' || drawing.type === 'line') {
                    ctx.beginPath();
                    ctx.moveTo(drawing.from.x, drawing.from.y);
                    ctx.lineTo(drawing.to.x, drawing.to.y);
                    ctx.stroke();
                } else if (drawing.type === 'arrow') {
                    drawArrow(ctx, drawing.from.x, drawing.from.y, drawing.to.x, drawing.to.y);
                } else if (drawing.type === 'rectangle') {
                    ctx.strokeRect(drawing.from.x, drawing.from.y, drawing.to.x - drawing.from.x, drawing.to.y - drawing.from.y);
                } else if (drawing.type === 'circle') {
                    const radius = Math.sqrt(Math.pow(drawing.to.x - drawing.from.x, 2) + Math.pow(drawing.to.y - drawing.from.y, 2));
                    ctx.beginPath();
                    ctx.arc(drawing.from.x, drawing.from.y, radius, 0, 2 * Math.PI);
                    ctx.stroke();
                } else if (drawing.type === 'highlight') {
                    ctx.globalAlpha = 0.3;
                    ctx.fillRect(drawing.from.x, drawing.from.y, drawing.to.x - drawing.from.x, drawing.to.y - drawing.from.y);
                    ctx.globalAlpha = 1;
                }
            });

            // Draw text boxes and stickers
            textBoxes.forEach(item => {
                if (item.type === 'sticker') {
                    ctx.font = `${item.size}px Arial`;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(item.emoji, item.x, item.y);
                } else {
                    ctx.save();
                    ctx.translate(item.x, item.y);
                    ctx.rotate((item.rotation || 0) * Math.PI / 180);
                    ctx.font = `${item.fontSize}px ${item.fontFamily}`;
                    ctx.textAlign = item.align;
                    ctx.textBaseline = 'top';
                    ctx.globalAlpha = item.opacity / 100;

                    if (item.strokeWidth > 0) {
                        ctx.strokeStyle = item.strokeColor;
                        ctx.lineWidth = item.strokeWidth;
                        ctx.strokeText(item.text, 0, 0);
                    }

                    ctx.fillStyle = item.color;
                    ctx.fillText(item.text, 0, 0);
                    ctx.restore();
                }
            });
        }

        function drawArrow(ctx, fromX, fromY, toX, toY) {
            const headlen = 20;
            const angle = Math.atan2(toY - fromY, toX - fromX);

            ctx.beginPath();
            ctx.moveTo(fromX, fromY);
            ctx.lineTo(toX, toY);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(toX, toY);
            ctx.lineTo(toX - headlen * Math.cos(angle - Math.PI / 6), toY - headlen * Math.sin(angle - Math.PI / 6));
            ctx.lineTo(toX - headlen * Math.cos(angle + Math.PI / 6), toY - headlen * Math.sin(angle + Math.PI / 6));
            ctx.closePath();
            ctx.fill();
        }

        // Undo/Redo
        function saveState() {
            history = history.slice(0, historyIndex + 1);
            history.push({
                textBoxes: JSON.parse(JSON.stringify(textBoxes)),
                drawings: JSON.parse(JSON.stringify(drawings)),
                filters: {...filters}
            });
            historyIndex++;
        }

        function undo() {
            if (historyIndex > 0) {
                historyIndex--;
                const state = history[historyIndex];
                textBoxes = JSON.parse(JSON.stringify(state.textBoxes));
                drawings = JSON.parse(JSON.stringify(state.drawings));
                filters = {...state.filters};
                drawCanvas();
                updateTextBoxControls();
            }
        }

        function redo() {
            if (historyIndex < history.length - 1) {
                historyIndex++;
                const state = history[historyIndex];
                textBoxes = JSON.parse(JSON.stringify(state.textBoxes));
                drawings = JSON.parse(JSON.stringify(state.drawings));
                filters = {...state.filters};
                drawCanvas();
                updateTextBoxControls();
            }
        }

        // AI Features
        async function generateAITemplate() {
            const prompt = await showCustomPrompt('Describe the meme template you want to generate:');
            if (!prompt) return;

            showLoadingModal('Generating AI template...');

            try {
                await window.Poe.sendUserMessage(
                    `@Imagen-4-Ultra ${prompt} --aspect_ratio 1:1`,
                    {
                        handler: 'aiTemplateHandler',
                        stream: false,
                        openChat: false
                    }
                );
            } catch (err) {
                closeModal();
                showCustomAlert('Error: ' + err.message);
            }
        }

        window.Poe.registerHandler('aiTemplateHandler', (result) => {
            const msg = result.responses[0];
            if (msg.status === 'complete' && msg.attachments && msg.attachments.length > 0) {
                const imageUrl = msg.attachments[0].url;
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = () => {
                    currentImage = img;
                    canvas.width = img.width;
                    canvas.height = img.height;
                    saveState();
                    drawCanvas();
                    closeModal();
                    showCustomAlert('AI template generated successfully!');
                };
                img.src = imageUrl;
            } else if (msg.status === 'error') {
                closeModal();
                showCustomAlert('Error generating template: ' + msg.statusText);
            }
        });

        async function generateAICaptions() {
            const context = await showCustomPrompt('Describe the meme context (e.g., "workplace humor", "gaming meme", "relatable content"):');
            if (!context) return;

            showLoadingModal('AI is generating caption suggestions...');

            try {
                await window.Poe.sendUserMessage(
                    `@GPT-5.1 Generate 5 funny and creative meme captions for a ${context} meme. Return ONLY a JSON array of strings, no other text. Example: ["Caption 1", "Caption 2", ...]`,
                    {
                        handler: 'aiCaptionHandler',
                        stream: false,
                        openChat: false
                    }
                );
            } catch (err) {
                closeModal();
                showCustomAlert('Error: ' + err.message);
            }
        }

        window.Poe.registerHandler('aiCaptionHandler', (result) => {
            const msg = result.responses[0];
            if (msg.status === 'complete') {
                closeModal();
                try {
                    const captions = JSON.parse(msg.content);
                    showCaptionSuggestions(captions);
                } catch (e) {
                    showCustomAlert('Generated captions:\n\n' + msg.content);
                }
            } else if (msg.status === 'error') {
                closeModal();
                showCustomAlert('Error: ' + msg.statusText);
            }
        });

        function showCaptionSuggestions(captions) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <span class="close-modal" onclick="this.closest('.modal').remove()">√ó</span>
                    <h2>AI Caption Suggestions</h2>
                    ${captions.map((caption, i) => `
                        <div class="ai-suggestion" style="cursor: pointer; margin: 10px 0;" onclick="applyCaptionSuggestion('${caption.replace(/'/g, "\\'")}', this.closest('.modal'))">
                            <p>${i + 1}. ${caption}</p>
                        </div>
                    `).join('')}
                </div>
            `;
            document.body.appendChild(modal);
        }

        function applyCaptionSuggestion(caption, modal) {
            if (textBoxes.length === 0) addTextBox();
            textBoxes[0].text = caption;
            drawCanvas();
            updateTextBoxControls();
            modal.remove();
        }

        async function analyzeImage() {
            if (!currentImage) {
                showCustomAlert('Please select or upload an image first');
                return;
            }

            showLoadingModal('AI is analyzing your image...');

            const imageData = canvas.toDataURL();

            try {
                // Convert data URL to File
                const blob = await (await fetch(imageData)).blob();
                const file = new File([blob], 'image.png', { type: 'image/png' });

                await window.Poe.sendUserMessage(
                    '@GPT-5.1 Analyze this image and suggest 3 funny meme captions that would work well. Return ONLY a JSON array of strings.',
                    {
                        attachments: [file],
                        handler: 'analyzeImageHandler',
                        stream: false,
                        openChat: false
                    }
                );
            } catch (err) {
                closeModal();
                showCustomAlert('Error: ' + err.message);
            }
        }

        window.Poe.registerHandler('analyzeImageHandler', (result) => {
            const msg = result.responses[0];
            if (msg.status === 'complete') {
                closeModal();
                try {
                    const captions = JSON.parse(msg.content);
                    showCaptionSuggestions(captions);
                } catch (e) {
                    showCustomAlert('AI Analysis:\n\n' + msg.content);
                }
            } else if (msg.status === 'error') {
                closeModal();
                showCustomAlert('Error: ' + msg.statusText);
            }
        });

        async function removeBackground() {
            if (!currentImage) {
                showCustomAlert('Please select or upload an image first');
                return;
            }

            showLoadingModal('Removing background...');

            const imageData = canvas.toDataURL();
            const blob = await (await fetch(imageData)).blob();
            const file = new File([blob], 'image.png', { type: 'image/png' });

            try {
                await window.Poe.sendUserMessage(
                    '@remove-background',
                    {
                        attachments: [file],
                        handler: 'removeBgHandler',
                        stream: false,
                        openChat: false
                    }
                );
            } catch (err) {
                closeModal();
                showCustomAlert('Error: ' + err.message);
            }
        }

        window.Poe.registerHandler('removeBgHandler', (result) => {
            const msg = result.responses[0];
            if (msg.status === 'complete' && msg.attachments && msg.attachments.length > 0) {
                const imageUrl = msg.attachments[0].url;
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = () => {
                    currentImage = img;
                    canvas.width = img.width;
                    canvas.height = img.height;
                    saveState();
                    drawCanvas();
                    closeModal();
                    showCustomAlert('Background removed successfully!');
                };
                img.src = imageUrl;
            } else if (msg.status === 'error') {
                closeModal();
                showCustomAlert('Error: ' + msg.statusText);
            }
        });

        async function startVoiceInput() {
            showCustomAlert('Voice input: Please record your audio and upload it to use speech-to-text. (Note: In a production environment, this would use device microphone)');

            // Create file input for audio
            const audioInput = document.createElement('input');
            audioInput.type = 'file';
            audioInput.accept = 'audio/*';
            audioInput.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    showLoadingModal('Converting speech to text...');
                    try {
                        await window.Poe.sendUserMessage(
                            '@Whisper-V3-Large-T',
                            {
                                attachments: [file],
                                handler: 'whisperHandler',
                                stream: false,
                                openChat: false
                            }
                        );
                    } catch (err) {
                        closeModal();
                        showCustomAlert('Error: ' + err.message);
                    }
                }
            };
            audioInput.click();
        }

        window.Poe.registerHandler('whisperHandler', (result) => {
            const msg = result.responses[0];
            if (msg.status === 'complete') {
                closeModal();
                if (textBoxes.length === 0) addTextBox();
                textBoxes[textBoxes.length - 1].text = msg.content;
                drawCanvas();
                updateTextBoxControls();
                showCustomAlert('Voice converted to text!');
            } else if (msg.status === 'error') {
                closeModal();
                showCustomAlert('Error: ' + msg.statusText);
            }
        });

        // Filter controls
        ['brightness', 'contrast', 'saturation', 'blur'].forEach(filter => {
            document.getElementById(filter).addEventListener('input', (e) => {
                filters[filter] = parseInt(e.target.value);
                document.getElementById(filter + 'Value').textContent = filter === 'blur' ? e.target.value + 'px' : e.target.value + '%';
                drawCanvas();
            });
        });

        // Style controls
        ['fontSize', 'fontFamily', 'textColor', 'strokeColor', 'strokeWidth', 'textOpacity'].forEach(id => {
            const elem = document.getElementById(id);
            if (elem) {
                elem.addEventListener('input', (e) => {
                    if (textBoxes.length > 0) {
                        const lastBox = textBoxes[textBoxes.length - 1];
                        if (lastBox.type === 'text') {
                            if (id === 'fontSize') lastBox.fontSize = parseInt(e.target.value);
                            else if (id === 'fontFamily') lastBox.fontFamily = e.target.value;
                            else if (id === 'textColor') lastBox.color = e.target.value;
                            else if (id === 'strokeColor') lastBox.strokeColor = e.target.value;
                            else if (id === 'strokeWidth') {
                                lastBox.strokeWidth = parseInt(e.target.value);
                                document.getElementById('strokeWidthValue').textContent = e.target.value;
                            }
                            else if (id === 'textOpacity') {
                                lastBox.opacity = parseInt(e.target.value);
                                document.getElementById('textOpacityValue').textContent = e.target.value + '%';
                            }
                            drawCanvas();
                        }
                    }
                });
            }
        });

        // Brush controls
        document.getElementById('brushSize').addEventListener('input', (e) => {
            document.getElementById('brushSizeValue').textContent = e.target.value;
        });

        function resetFilters() {
            filters = { brightness: 100, contrast: 100, saturation: 100, blur: 0 };
            ['brightness', 'contrast', 'saturation', 'blur'].forEach(f => {
                document.getElementById(f).value = f === 'blur' ? 0 : 100;
                document.getElementById(f + 'Value').textContent = f === 'blur' ? '0px' : '100%';
            });
            drawCanvas();
        }

        // GIF functions
        function captureFrame() {
            gifFrames.push(canvas.toDataURL());
            updateFramePreview();
            document.getElementById('createGIFBtn').disabled = gifFrames.length < 2;
        }

        function updateFramePreview() {
            const preview = document.getElementById('framePreview');
            preview.innerHTML = `<p style="color: var(--text-secondary);">${gifFrames.length} frames captured</p>`;
        }

        function createGIF() {
            if (gifFrames.length < 2) {
                showCustomAlert('Capture at least 2 frames first');
                return;
            }

            showLoadingModal('Creating GIF...');

            const gif = new GIF({
                workers: 2,
                quality: 10,
                width: canvas.width,
                height: canvas.height,
                workerScript: 'https://cdnjs.cloudflare.com/ajax/libs/gif.js/0.2.0/gif.worker.js'
            });

            const delay = parseInt(document.getElementById('frameDelay').value);
            const promises = gifFrames.map(frameData => {
                return new Promise((resolve) => {
                    const img = new Image();
                    img.onload = () => resolve(img);
                    img.src = frameData;
                });
            });

            Promise.all(promises).then(images => {
                images.forEach(img => {
                    gif.addFrame(img, { delay: delay });
                });

                gif.on('finished', (blob) => {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'meme.gif';
                    a.click();
                    closeModal();
                    updateMonetization('create');
                    showCustomAlert('GIF created successfully!');
                });

                gif.render();
            });
        }

        // Download & Share
        function downloadMeme() {
            if (!currentImage) {
                showCustomAlert('Please select or upload an image first');
                return;
            }

            const tempCanvas = document.createElement('canvas');
            const tempCtx = tempCanvas.getContext('2d');
            const scale = 4;

            tempCanvas.width = canvas.width * scale;
            tempCanvas.height = canvas.height * scale;

            tempCtx.filter = `brightness(${filters.brightness}%) contrast(${filters.contrast}%) saturate(${filters.saturation}%) blur(${filters.blur * scale}px)`;
            tempCtx.drawImage(currentImage, 0, 0, tempCanvas.width, tempCanvas.height);
            tempCtx.filter = 'none';

            drawings.forEach(drawing => {
                tempCtx.strokeStyle = drawing.color;
                tempCtx.fillStyle = drawing.color;
                tempCtx.lineWidth = drawing.size * scale;

                if (drawing.type === 'pen' || drawing.type === 'line') {
                    tempCtx.beginPath();
                    tempCtx.moveTo(drawing.from.x * scale, drawing.from.y * scale);
                    tempCtx.lineTo(drawing.to.x * scale, drawing.to.y * scale);
                    tempCtx.stroke();
                }
            });

            textBoxes.forEach(item => {
                if (item.type === 'sticker') {
                    tempCtx.font = `${item.size * scale}px Arial`;
                    tempCtx.textAlign = 'center';
                    tempCtx.textBaseline = 'middle';
                    tempCtx.fillText(item.emoji, item.x * scale, item.y * scale);
                } else {
                    tempCtx.save();
                    tempCtx.translate(item.x * scale, item.y * scale);
                    tempCtx.rotate((item.rotation || 0) * Math.PI / 180);
                    tempCtx.font = `${item.fontSize * scale}px ${item.fontFamily}`;
                    tempCtx.textAlign = item.align;
                    tempCtx.globalAlpha = item.opacity / 100;

                    if (item.strokeWidth > 0) {
                        tempCtx.strokeStyle = item.strokeColor;
                        tempCtx.lineWidth = item.strokeWidth * scale;
                        tempCtx.strokeText(item.text, 0, 0);
                    }

                    tempCtx.fillStyle = item.color;
                    tempCtx.fillText(item.text, 0, 0);
                    tempCtx.restore();
                }
            });

            const link = document.createElement('a');
            link.download = 'imgbazaar-meme-4k.png';
            link.href = tempCanvas.toDataURL('image/png');
            link.click();

            updateMonetization('create');
        }

        function shareMeme() {
            if (!currentImage) {
                showCustomAlert('Please select or upload an image first');
                return;
            }

            canvas.toBlob((blob) => {
                const file = new File([blob], 'meme.png', { type: 'image/png' });

                if (navigator.share) {
                    navigator.share({
                        title: 'Check out my meme!',
                        text: 'Made with ImgBazaar Pro',
                        files: [file]
                    }).then(() => {
                        updateMonetization('share');
                        addToGallery(canvas.toDataURL());
                    }).catch(() => {
                        downloadMeme();
                    });
                } else {
                    downloadMeme();
                    addToGallery(canvas.toDataURL());
                    updateMonetization('share');
                }
            });
        }

        function mintNFT() {
            if (!currentImage) {
                showCustomAlert('Please select or upload an image first');
                return;
            }

            showCustomConfirm('Mint this meme as an NFT on the blockchain? (Gas fees: $2.50)', () => {
                showLoadingModal('Minting NFT...');
                setTimeout(() => {
                    closeModal();
                    const nftId = 'NFT-' + Math.random().toString(36).substr(2, 9).toUpperCase();
                    showCustomAlert(`Success! Your meme has been minted as NFT.\n\nToken ID: ${nftId}\nBlockchain: Ethereum\nContract: 0x742d35Cc...`);
                    addToGallery(canvas.toDataURL(), true);
                }, 2000);
            });
        }

        function openCollabRoom() {
            showCustomAlert('üéâ Collaboration feature!\n\nIn production, this would:\n‚Ä¢ Generate a unique room code\n‚Ä¢ Enable real-time multi-user editing\n‚Ä¢ Show live cursors and changes\n‚Ä¢ Support voice chat\n\nShare the room code with friends to collaborate!');
        }

        function duplicateCanvas() {
            saveState();
            showCustomAlert('Canvas state duplicated! (Saved to history)');
        }

        function exportBatch() {
            showCustomAlert('Batch export: Create multiple variations with different text/filters and export all at once!\n\n(This feature would allow batch processing in production)');
        }

        function clearCanvas() {
            showCustomConfirm('Clear everything and start over?', () => {
                currentImage = null;
                textBoxes = [];
                drawings = [];
                gifFrames = [];
                resetFilters();
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                updateTextBoxControls();
                history = [];
                historyIndex = -1;
            });
        }

        // Gallery
        function addToGallery(dataURL, isNFT = false) {
            const grid = document.getElementById('galleryGrid');
            const emptyState = grid.querySelector('.empty-state');
            if (emptyState) emptyState.remove();

            const views = Math.floor(Math.random() * 5000) + 100;
            const shares = Math.floor(Math.random() * 500) + 10;

            const div = document.createElement('div');
            div.className = 'gallery-item';
            div.innerHTML = `
                <img src="${dataURL}" alt="Meme">
                <div class="gallery-item-info">
                    ${isNFT ? '<span class="nft-badge">NFT</span>' : ''}
                    <div class="gallery-item-stats">
                        <span>üëÅÔ∏è ${views}</span>
                        <span>üì§ ${shares}</span>
                        <span>üí∞ $${(views * 0.01 + shares * 0.1).toFixed(2)}</span>
                    </div>
                </div>
                <div class="gallery-item-actions">
                    <button class="icon-btn" onclick="viewInModal('${dataURL}')">üîç</button>
                    <button class="icon-btn" onclick="deleteFromGallery(this)">üóëÔ∏è</button>
                </div>
            `;
            grid.insertBefore(div, grid.firstChild);
            monetizationData.memes++;
            updateMonetizationDisplay();
        }

        function viewInModal(dataURL) {
            const content = document.getElementById('modalContentArea');
            content.innerHTML = `<img src="${dataURL}" style="max-width: 100%;">`;
            document.getElementById('imageModal').classList.add('active');
        }

        function deleteFromGallery(btn) {
            showCustomConfirm('Delete this meme?', () => {
                btn.closest('.gallery-item').remove();
            });
        }

        // Monetization
        function updateMonetization(action) {
            if (action === 'create') {
                monetizationData.totalEarnings += 0.50;
                monetizationData.earningsToday += 0.50;
            } else if (action === 'share') {
                monetizationData.shares++;
                monetizationData.totalEarnings += 0.10;
                monetizationData.earningsToday += 0.10;
            } else if (action === 'view') {
                monetizationData.views++;
                monetizationData.totalEarnings += 0.01;
                monetizationData.earningsToday += 0.01;
            }
            updateMonetizationDisplay();
        }

        function updateMonetizationDisplay() {
            document.getElementById('totalEarnings').textContent = monetizationData.totalEarnings.toFixed(2);
            document.getElementById('earningsToday').textContent = monetizationData.earningsToday.toFixed(2);
            document.getElementById('viewCount').textContent = monetizationData.views;
            document.getElementById('shareCount').textContent = monetizationData.shares;
            document.getElementById('memeCount').textContent = monetizationData.memes;
            document.getElementById('analyticsEarnings').textContent = monetizationData.totalEarnings.toFixed(2);
        }

        function withdrawEarnings() {
            if (monetizationData.totalEarnings < 10) {
                showCustomAlert(`Minimum withdrawal is $10.00\n\nYour balance: $${monetizationData.totalEarnings.toFixed(2)}\nYou need: $${(10 - monetizationData.totalEarnings).toFixed(2)} more`);
                return;
            }

            showCustomConfirm(`Withdraw $${monetizationData.totalEarnings.toFixed(2)} to your PayPal account?`, () => {
                showCustomAlert(`Success! $${monetizationData.totalEarnings.toFixed(2)} will be deposited within 3-5 business days.`);
                monetizationData.totalEarnings = 0;
                monetizationData.earningsToday = 0;
                updateMonetizationDisplay();
            });
        }

        // Social Feed
        function initializeSocialFeed() {
            const feed = document.getElementById('socialFeed');
            const demoMemes = [
                { views: 15234, likes: 1203, comments: 89, trending: true },
                { views: 8932, likes: 672, comments: 45, hot: true },
                { views: 23401, likes: 2109, comments: 156, trending: true },
                { views: 5621, likes: 423, comments: 28, new: true },
            ];

            demoMemes.forEach((meme, i) => {
                const div = document.createElement('div');
                div.className = 'gallery-item';
                div.innerHTML = `
                    <img src="https://picsum.photos/seed/social${i}/400/400" alt="Meme">
                    <div class="gallery-item-info">
                        <div>
                            ${meme.trending ? '<span class="badge badge-trending">üî• TRENDING</span>' : ''}
                            ${meme.hot ? '<span class="badge badge-hot">‚≠ê HOT</span>' : ''}
                            ${meme.new ? '<span class="badge badge-new">‚ú® NEW</span>' : ''}
                        </div>
                        <div class="gallery-item-stats">
                            <span>üëÅÔ∏è ${meme.views.toLocaleString()}</span>
                            <span>‚ù§Ô∏è ${meme.likes.toLocaleString()}</span>
                            <span>üí¨ ${meme.comments}</span>
                        </div>
                    </div>
                `;
                feed.appendChild(div);
            });
        }

        // Challenges
        function initializeChallenges() {
            const list = document.getElementById('challengesList');
            const challenges = [
                { title: 'Weekend Vibes', prize: '$500', entries: 234, ends: '2 days', featured: true },
                { title: 'Office Humor', prize: '$200', entries: 156, ends: '5 days' },
                { title: 'Gaming Memes', prize: '$300', entries: 189, ends: '1 week' },
            ];

            challenges.forEach(c => {
                const div = document.createElement('div');
                div.className = `challenge-card ${c.featured ? 'featured' : ''}`;
                div.innerHTML = `
                    <h3>üèÜ ${c.title} ${c.featured ? '<span class="badge badge-hot">FEATURED</span>' : ''}</h3>
                    <p style="color: var(--text-secondary); margin: 10px 0;">Prize: <span class="price-tag">${c.prize}</span></p>
                    <p style="color: var(--text-secondary); font-size: 0.9rem;">${c.entries} entries ‚Ä¢ Ends in ${c.ends}</p>
                    <button class="btn" style="margin-top: 15px;" onclick="enterChallenge('${c.title}')">Enter Challenge</button>
                `;
                list.appendChild(div);
            });
        }

        function enterChallenge(title) {
            showCustomAlert(`You've entered the "${title}" challenge!\n\nCreate your best meme and submit it before the deadline. Good luck! üçÄ`);
        }

        // Marketplace
        function initializeMarketplace() {
            const grid = document.getElementById('marketplaceGrid');
            const items = [
                { name: 'Retro Pack', price: '$4.99', sales: 1234 },
                { name: 'Anime Collection', price: '$6.99', sales: 890 },
                { name: 'Nature Templates', price: '$3.99', sales: 567 },
                { name: 'Corporate Memes', price: '$5.99', sales: 432 },
            ];

            items.forEach((item, i) => {
                const div = document.createElement('div');
                div.className = 'marketplace-item';
                div.innerHTML = `
                    <img src="https://picsum.photos/seed/market${i}/300/200" alt="${item.name}">
                    <div style="padding: 15px;">
                        <h3 style="font-size: 1.1rem; margin-bottom: 10px;">${item.name}</h3>
                        <p style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 10px;">${item.sales} sales</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span class="price-tag">${item.price}</span>
                            <button class="btn btn-small" onclick="purchaseTemplate('${item.name}', '${item.price}')">Buy</button>
                        </div>
                    </div>
                `;
                grid.appendChild(div);
            });
        }

        function purchaseTemplate(name, price) {
            showCustomConfirm(`Purchase "${name}" for ${price}?`, () => {
                showCustomAlert(`Success! "${name}" has been added to your templates.\n\n70% of this sale goes to the creator! üí∞`);
            });
        }

        // Sponsors
        function initializeSponsors() {
            const list = document.getElementById('sponsorsList');
            const sponsors = [
                { brand: 'TechCorp', budget: '$2,000', desc: 'Create memes about our new smartphone launch', category: 'Technology' },
                { brand: 'FitLife', budget: '$1,500', desc: 'Fitness motivation memes', category: 'Health' },
                { brand: 'GameZone', budget: '$3,000', desc: 'Gaming humor and reviews', category: 'Gaming' },
            ];

            sponsors.forEach(s => {
                const div = document.createElement('div');
                div.className = 'sponsor-card';
                div.innerHTML = `
                    <h3>üíº ${s.brand}</h3>
                    <p style="margin: 10px 0; color: var(--text-secondary);">${s.desc}</p>
                    <p style="font-size: 0.9rem; color: var(--text-secondary);">Category: ${s.category}</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px;">
                        <span class="price-tag">${s.budget}</span>
                        <button class="btn btn-small" onclick="applyForSponsorship('${s.brand}')">Apply</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function applyForSponsorship(brand) {
            showCustomAlert(`Application submitted to ${brand}!\n\nThey'll review your portfolio and get back to you within 48 hours. üìß`);
        }

        // Keyboard shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    if (e.key === 'z') {
                        e.preventDefault();
                        undo();
                    } else if (e.key === 'y') {
                        e.preventDefault();
                        redo();
                    } else if (e.key === 't') {
                        e.preventDefault();
                        addTextBox();
                    } else if (e.key === 'd') {
                        e.preventDefault();
                        duplicateCanvas();
                    } else if (e.key === 's') {
                        e.preventDefault();
                        downloadMeme();
                    }
                } else if (e.key === '?') {
                    showKeyboardShortcuts();
                }
            });
        }

        function showKeyboardShortcuts() {
            showCustomAlert(`‚å®Ô∏è Keyboard Shortcuts:

Ctrl+Z - Undo
Ctrl+Y - Redo
Ctrl+T - Add Text Box
Ctrl+D - Duplicate Canvas
Ctrl+S - Download
? - Show this help`);
        }

        // View simulation
        function startViewSimulation() {
            setInterval(() => {
                if (Math.random() > 0.7) {
                    updateMonetization('view');
                }
            }, 5000);
        }

        // Page switching
        function switchPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));

            document.getElementById(page + 'Page').classList.add('active');
            event.target.classList.add('active');
        }

        // Tab switching
        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        // Modal helpers
        function closeModal() {
            document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
        }

        function showCustomAlert(message) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <p style="color: var(--text-primary); white-space: pre-line; margin-bottom: 20px;">${message}</p>
                    <button class="btn" onclick="this.closest('.modal').remove()">OK</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function showCustomConfirm(message, onConfirm) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 500px;">
                    <p style="color: var(--text-primary); margin-bottom: 20px;">${message}</p>
                    <div class="controls-grid">
                        <button class="btn btn-secondary" onclick="this.closest('.modal').remove()">Cancel</button>
                        <button class="btn" onclick="confirmAction(this)">Confirm</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            window.confirmAction = (btn) => {
                btn.closest('.modal').remove();
                onConfirm();
            };
        }

        function showCustomPrompt(message) {
            return new Promise((resolve) => {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="modal-content" style="max-width: 500px;">
                        <p style="color: var(--text-primary); margin-bottom: 15px;">${message}</p>
                        <input type="text" id="promptInput" placeholder="Enter text..." style="margin-bottom: 15px;">
                        <div class="controls-grid">
                            <button class="btn btn-secondary" onclick="resolvePrompt(null, this)">Cancel</button>
                            <button class="btn" onclick="resolvePrompt(document.getElementById('promptInput').value, this)">OK</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);

                window.resolvePrompt = (value, btn) => {
                    btn.closest('.modal').remove();
                    resolve(value);
                };
            });
        }

        function showLoadingModal(message) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.id = 'loadingModal';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 400px; text-align: center;">
                    <div class="loading-spinner"></div>
                    <p style="color: var(--text-primary); margin-top: 20px;">${message}</p>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // Initialize app
        init();
    </script>



</body></html>