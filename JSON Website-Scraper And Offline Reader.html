<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON Web-Scraper And Offline Web-Reader</title>
    <style>
        /*CSS */
        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --accent-color: #007bff;
        }
        body.dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --accent-color: #0d6efd;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            transition: all 0.3s ease;
        }
        .container {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .section {
            flex: 1;
            min-width: 300px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: var(--bg-color);
        }
        textarea {
            width: 100%;
            height: 300px;
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #ddd;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        button {
            padding: 10px 20px;
            margin: 5px 0;
            cursor: pointer;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }
        button:hover {
            opacity: 0.9;
        }
        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-bar-fill {
            height: 100%;
            background-color: var(--accent-color);
            width: 0%;
            transition: width 0.3s ease;
        }
        .history-item {
            padding: 5px;
            margin: 2px 0;
            cursor: pointer;
            border-radius: 4px;
        }
        .history-item:hover {
            background-color: rgba(0,123,255,0.1);
        }
        .highlight {
            background-color: #ffeb3b;
            padding: 2px;
        }
        .toolbar {
            margin: 10px 0;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        .reader-controls {
            margin: 10px 0;
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .speech-controls {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        .annotation {
            background-color: #fff3cd;
            padding: 5px;
            margin: 2px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>JSON Web-Scraper And Offline Web-Reader</h1>
    <div class="toolbar">
        <button onclick="toggleDarkMode()">Toggle Dark Mode</button>
        <button onclick="clearHistory()">Clear History</button>
        <button onclick="exportAll()">Export All</button>
    </div>
    <div class="container">
        <div class="section">
            <h2>Web Scraper</h2>
            <input type="text" id="urlInput" placeholder="Enter website URL">
            <div class="progress-bar">
                <div class="progress-bar-fill"></div>
            </div>
            <button onclick="scrapeWebsite()">Scrape Website</button>
            <select id="elementType" onchange="updateScrapingOptions()">
                <option value="all">All Content</option>
                <option value="headings">Headings</option>
                <option value="paragraphs">Paragraphs</option>
                <option value="images">Images</option>
                <option value="metadata">Metadata</option>
            </select>
            <textarea id="scrapedContent" readonly></textarea>
            <button onclick="saveAsJson()">Save as JSON</button>
            <div id="scrapingHistory" class="history"></div>
        </div>
        <div class="section">
            <h2>Offline Reader</h2>
            <input type="file" id="jsonFileInput" accept=".json">
            <textarea id="jsonContent" readonly></textarea>
            <div class="reader-controls">
                <button onclick="loadJson()">Load JSON</button>
                <button onclick="highlightCode()">Highlight Code</button>
                <button onclick="generateTOC()">Generate TOC</button>
            </div>
            <div class="speech-controls">
                <button onclick="startSpeech()">Start Speech</button>
                <button onclick="stopSpeech()">Stop Speech</button>
                <select id="voiceSelect"></select>
            </div>
            <div id="annotations"></div>
        </div>
    </div>

    <script>
        // Enhanced JavaScript
        let scrapedData = null;
        let history = JSON.parse(localStorage.getItem('scrapingHistory')) || [];
        let speechSynthesis = window.speechSynthesis;
        let currentSpeech = null;
        let annotations = [];

        // Initialize dark mode
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add('dark-mode');
        }

        // Initialize voices
        let voices = [];
        function populateVoiceList() {
            voices = speechSynthesis.getVoices();
            const voiceSelect = document.getElementById('voiceSelect');
            voiceSelect.innerHTML = voices
                .map(voice => `<option value="${voice.name}">${voice.name} (${voice.lang})</option>`)
                .join('');
        }
        populateVoiceList();
        speechSynthesis.onvoiceschanged = populateVoiceList;

        // Enhanced scraping function
        async function scrapeWebsite() {
            const url = document.getElementById('urlInput').value;
            if (!url) {
                alert('Please enter a valid URL');
                return;
            }

            try {
                updateProgress(0);
                const response = await fetch(`https://api.allorigins.win/get?url=${encodeURIComponent(url)}`);
                updateProgress(50);
                const data = await response.json();
                updateProgress(100);

                // Enhanced content extraction
                const parser = new DOMParser();
                const doc = parser.parseFromString(data.contents, 'text/html');
                const elementType = document.getElementById('elementType').value;
                let content = '';

                switch (elementType) {
                    case 'headings':
                        content = Array.from(doc.querySelectorAll('h1, h2, h3, h4, h5, h6'))
                            .map(el => el.outerHTML)
                            .join('\n');
                        break;
                    case 'paragraphs':
                        content = Array.from(doc.querySelectorAll('p'))
                            .map(el => el.outerHTML)
                            .join('\n');
                        break;
                    case 'images':
                        content = Array.from(doc.querySelectorAll('img'))
                            .map(el => `<img src="${el.src}" alt="${el.alt}">`)
                            .join('\n');
                        break;
                    case 'metadata':
                        const meta = {
                            title: doc.title,
                            description: doc.querySelector('meta[name="description"]')?.content,
                            keywords: doc.querySelector('meta[name="keywords"]')?.content,
                            author: doc.querySelector('meta[name="author"]')?.content
                        };
                        content = JSON.stringify(meta, null, 2);
                        break;
                    default:
                        content = data.contents;
                }

                scrapedData = {
                    url: url,
                    content: content,
                    timestamp: new Date().toISOString(),
                    metadata: {
                        title: doc.title,
                        description: doc.querySelector('meta[name="description"]')?.content
                    }
                };

                document.getElementById('scrapedContent').value = JSON.stringify(scrapedData, null, 2);
                addToHistory(scrapedData);
            } catch (error) {
                console.error('Error scraping website:', error);
                alert('Error scraping website. Please try again.');
            }
        }

        // Enhanced file management
        function saveAsJson() {
            if (!scrapedData) {
                alert('No data to save');
                return;
            }

            const blob = new Blob([JSON.stringify(scrapedData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `scraped_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function exportAll() {
            const blob = new Blob([JSON.stringify(history, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `scraping_history_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Enhanced reader features
        function loadJson() {
            const fileInput = document.getElementById('jsonFileInput');
            const file = fileInput.files[0];
            if (!file) {
                alert('Please select a JSON file');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    document.getElementById('jsonContent').value = JSON.stringify(data, null, 2);
                    highlightCode();
                } catch (error) {
                    console.error('Error parsing JSON:', error);
                    alert('Invalid JSON file');
                }
            };
            reader.readAsText(file);
        }

        function highlightCode() {
            const content = document.getElementById('jsonContent').value;
            try {
                const json = JSON.parse(content);
                document.getElementById('jsonContent').value = JSON.stringify(json, null, 2);
            } catch (error) {
                console.error('Error highlighting code:', error);
            }
        }

        function generateTOC() {
            const content = document.getElementById('jsonContent').value;
            try {
                const json = JSON.parse(content);
                let toc = '## Table of Contents\n';
                if (json.metadata) {
                    toc += `- Title: ${json.metadata.title || 'N/A'}\n`;
                    toc += `- Description: ${json.metadata.description || 'N/A'}\n`;
                }
                toc += `- URL: ${json.url}\n`;
                toc += `- Timestamp: ${json.timestamp}\n`;
                document.getElementById('jsonContent').value = `${toc}\n\n${document.getElementById('jsonContent').value}`;
            } catch (error) {
                console.error('Error generating TOC:', error);
            }
        }

        // Speech synthesis
        function startSpeech() {
            if (currentSpeech) {
                speechSynthesis.cancel();
            }
            const content = document.getElementById('jsonContent').value;
            const utterance = new SpeechSynthesisUtterance(content);
            utterance.voice = voices.find(voice => voice.name === document.getElementById('voiceSelect').value);
            speechSynthesis.speak(utterance);
            currentSpeech = utterance;
        }

        function stopSpeech() {
            speechSynthesis.cancel();
            currentSpeech = null;
        }

        // History management
        function addToHistory(data) {
            history.push(data);
            localStorage.setItem('scrapingHistory', JSON.stringify(history));
            updateHistoryDisplay();
        }

        function clearHistory() {
            history = [];
            localStorage.removeItem('scrapingHistory');
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const historyDiv = document.getElementById('scrapingHistory');
            historyDiv.innerHTML = history
                .map((item, index) => `
                    <div class="history-item" onclick="loadFromHistory(${index})">
                        ${item.metadata?.title || 'Untitled'} - ${new Date(item.timestamp).toLocaleString()}
                    </div>
                `)
                .join('');
        }

        function loadFromHistory(index) {
            const item = history[index];
            document.getElementById('scrapedContent').value = JSON.stringify(item, null, 2);
            scrapedData = item;
        }

        // UI enhancements
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode') ? 'enabled' : 'disabled');
        }

        function updateProgress(percentage) {
            document.querySelector('.progress-bar-fill').style.width = `${percentage}%`;
        }

        // Initialize
        updateHistoryDisplay();
    </script>
</body>
</html>
